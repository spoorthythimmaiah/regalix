{"version":3,"sources":["webpack:///./sharedemos/static/js/reports/models/reports.js","webpack:///./sharedemos/static/js/reports/views/new_reports.js"],"names":["define","Backbone","ReportsApi","Model","extend","urlRoot","_","$","SiteTrafficTemplate","TrendingChaptersTemplate","ReferralsTemplate","GeographyTemplate","ReportsView","View","el","events","initialize","utcoffset","document","offset","initDates","render","root","datepicker","language","dateFormat","minDate","Date","tenant_created_at","maxDate","autoClose","clearButton","onSelect","selectedDate","date","toDate","val","data","update","attrs","product_id","attr","loadReports","fromDate","isAuthor","removeClass","addClass","appendTo","reports_data","fetch","done","response","html","popover","trending_chapters","sort_chapters_by","loadMoreChapters","loadTrendingChapters","loadVisitorsVsViewsGraph","graphs","visitors_vs_views","loadTrendingCategories","trending_categories","loadReferrals","referrals","loadGeography","geography","fail","console","log","always","remove","tr_ch","first_sort_by","sec_sort_by","chain","sortBy","reverse","value","first","filterReports","event","date_range","target","parentElement","id","getAttribute","show","hide","clear","textContent","from_date","to_date","selectedDates","length","sortPopularChapters","parent","hasClass","geography_list","map","key","isEmptyObject","mapGeoJSON","Highcharts","maps","country_iso_code_key","each","features","index","feature","countryISOCode","properties","visit_count","push","highcharts","title","text","mapNavigation","enabled","buttonOptions","verticalAlign","navigation","colorAxis","min","stops","getOptions","colors","Color","brighten","get","legend","series","mapData","joinBy","name","states","hover","color","type","geojson","nullColor","showInLegend","enableMouseTracking","referral_list","count","label","col1","col2","col3","col4","col5","col6","col7","col8","col9","col10","plot","pie","innerRadius","shadow","top","left","alpha","stroke","width","radius","background","opacity","threshold","highlight","grid","hoverable","clickable","bind","pos","item","tooltip","parseFloat","percent","toFixed","css","pageY","pageX","fadeIn","categories","x_axis_labels","word","views","substring","bars","order","align","lineWidth","barWidth","fill","fillColor","shadowSize","tickColor","borderWidth","margin","xaxis","autoscaleMargin","ticks","tickDecimals","tickLength","yaxis","dataIndex","visitors","Array","slots","site_visitors","getGraphDate","demo_views","tick_size","unit_between","format","Max","Min","multiplier","dayone","daytwo","daysdiff","dayDifference","curvedLines","apply","monotonicFit","points","symbol","lines","active","max","mode","timeformat","tickSize","time1","time2","timeDiff","Math","abs","ceil","loadMore","children","date_string","date_string_list","split","year","parseInt","month","day","tzOffset","getTimezoneOffset","time","getTime"],"mappings":"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","file":"32.5fb929.js","sourcesContent":["/*global define */\ndefine([\n    'backbone'\n], function (Backbone) {\n    'use strict';\n\n    var ReportsApi = Backbone.Model.extend({\n        urlRoot: \"/api/new_reports\",\n    });\n\n    return ReportsApi;\n});","/*global define*/\ndefine(['underscore',\n        'jquery',\n        'backbone',\n        '../models/reports',\n        '../templates/site_traffic.handlebars',\n        '../templates/trending_chapters.handlebars',\n        '../templates/referrals.handlebars',\n        '../templates/geography.handlebars'\n], function (_, $, Backbone,\n             ReportsApi,\n             SiteTrafficTemplate,\n             TrendingChaptersTemplate,\n             ReferralsTemplate,\n             GeographyTemplate) {\n    'use strict';\n\n    var ReportsView = Backbone.View.extend({\n\n        el: '#library_reports',\n\n        events: {\n            'click .dd-menu li': 'filterReports',\n            'click .load_more_reports': 'loadMore',\n            'click .sort': 'sortPopularChapters'\n        },\n\n        initialize: function(){\n            this.utcoffset = document.offset;\n            this.initDates();\n            this.render();\n        },\n\n        initDates: function(){\n            var root = this;\n            this.$('#from-date').datepicker({\n                language: 'en',\n                dateFormat: \"yyyy-mm-dd\",\n                minDate: new Date(document.tenant_created_at),\n                maxDate: new Date(),\n                autoClose: true,\n                clearButton: true,\n                onSelect: function(selectedDate, date){\n                    var toDate = root.$('#to-date').val();\n                    if(date){\n                        root.$('#to-date').datepicker().data('datepicker').update('minDate', date);\n                    }\n                    if(selectedDate && toDate){\n                        var attrs = {\n                            'date_range' : 'custom',\n                            'start_date' : selectedDate,\n                            'end_date' : toDate,\n                            'offset': root.utcoffset\n                        }\n                        let product_id = root.$('#categories li.active').attr('data-attr');\n                        if(product_id !== '0'){\n                            attrs['product_id'] = product_id;\n                        }\n                        root.loadReports(attrs);\n                    }\n                },\n            });\n            this.$('#to-date').datepicker({\n                language: 'en',\n                dateFormat: \"yyyy-mm-dd\",\n                minDate: new Date(document.tenant_created_at),\n                maxDate: new Date(),\n                autoClose: true,\n                clearButton: true,\n                onSelect: function(selectedDate, date){\n                    var fromDate = root.$('#from-date').val();\n                    root.$('#from-date').datepicker().data('datepicker').update('maxDate', date || new Date());\n                    if(selectedDate && fromDate){\n                        var attrs = {\n                            'date_range' : 'custom',\n                            'start_date' : fromDate,\n                            'end_date' : selectedDate,\n                            'offset': root.utcoffset\n                        }\n                        let product_id = root.$('#categories li.active').attr('data-attr');\n                        if(product_id !== '0'){\n                            attrs['product_id'] = product_id;\n                        }\n                        root.loadReports(attrs);   \n                    }\n                }\n            });\n        },\n\n        render: function () {\n            if(!document.isAuthor){\n                this.$('#content_menu li').removeClass('active');\n                this.$('#content_menu, .nav-pills li[role=\"overview\"]').addClass('disabled');\n            }\n\n            this.loadReports({\n                'date_range': 'week',\n                'offset': this.utcoffset\n            });\n        },\n\n        loadReports: function(data){\n            $(\"<div id='loading_data'></div>\").appendTo('#main_container');\n            var reports_data = new ReportsApi();\n            var root = this;\n            reports_data.fetch({\n                data: data\n            }).done(function(response){\n                root.$('#user_analytics').html(SiteTrafficTemplate(response))\n                root.$('[data-toggle=\"popover\"]').popover({\n                    html: true\n                });\n                root.trending_chapters = response.trending_chapters;\n                root.sort_chapters_by = 'views';\n                root.loadMoreChapters = false;\n                root.loadTrendingChapters();\n                root.loadVisitorsVsViewsGraph(response.graphs.visitors_vs_views);\n                root.loadTrendingCategories(response.graphs.trending_categories);\n                root.loadReferrals(response.graphs.referrals);\n                root.loadGeography(response.graphs.geography)\n            }).fail(function(response){\n                console.log('Loading reports failed...');\n            }).always(function(){\n                $('#loading_data')[0].remove();\n            });\n        },\n\n        loadTrendingChapters: function(){\n            var tr_ch = this.trending_chapters;\n            var first_sort_by = this.sort_chapters_by == 'views'? 'completion_rate': 'views';\n            var sec_sort_by = this.sort_chapters_by;\n            tr_ch = _.chain(tr_ch).sortBy(first_sort_by).sortBy(sec_sort_by).reverse().value();\n            tr_ch = _.first(tr_ch, 10);\n            this.$('.most_popular_chapters .data_block').html(\n                TrendingChaptersTemplate({\n                    'trending_chapters': tr_ch,\n                    'sort_by': this.sort_chapters_by,\n                    'load_more': this.loadMoreChapters\n                })\n            )\n        },\n\n        filterReports: function(event){\n            var date_range = 'week';\n            var product_id = 0;\n\n            if(event.target.parentElement.id == 'metrics'){\n                date_range = event.target.getAttribute('data-attr');\n                this.$('.time-interval-dd .interval').html(date_range);\n                this.$('#metrics li').removeClass('active');\n                this.$(event.target).addClass('active');\n                \n                if(date_range == 'custom'){\n                    this.$('.custome-date').show();\n                    return false;\n                } else {\n                    this.$('.custome-date').hide();\n                }\n                \n                this.$('#from-date').data('datepicker').clear();\n                this.$('#to-date').data('datepicker').clear();\n                product_id = this.$('#categories li.active').attr('data-attr');\n                \n                this.$('.time-interval-dd .interval').html(event.target.getAttribute('data-title'));\n                this.$('#metrics li').removeClass('active');\n                this.$(event.target).addClass('active');\n            }else if(event.target.parentElement.id == 'categories'){\n                product_id = event.target.getAttribute('data-attr');\n                date_range = this.$('#metrics li.active').attr('data-attr');\n                this.$('.category-dd .category').html(event.target.textContent);\n                this.$('#categories li').removeClass('active');\n                this.$(event.target).addClass('active');\n            }\n            var attrs = {\n                'date_range': date_range,\n                'offset': this.utcoffset\n            }\n            if(product_id && product_id !== '0'){\n                attrs['product_id'] = product_id\n            }\n            if(date_range == 'custom'){\n                var from_date = this.$('#from-date').datepicker().data('datepicker');\n                var to_date = this.$('#to-date').datepicker().data('datepicker');\n                if(from_date.selectedDates.length && to_date.selectedDates.length){\n                    attrs['start_date'] = this.$('#from-date').val()\n                    attrs['end_date'] = this.$('#to-date').val()\n                    this.loadReports(attrs)\n                }\n            }else{\n               this.loadReports(attrs)\n            }\n        },\n\n        sortPopularChapters: function(event){\n            if(this.$(event.target).parent().hasClass('active')) return false;\n\n            this.sort_chapters_by = this.sort_chapters_by == 'views'? 'completion_rate': 'views';\n            this.loadTrendingChapters();\n        },\n\n        loadGeography: function(geography){\n            var geography_list = _.map(geography, function(val, key) {\n                return val;\n            });\n\n            this.$('.geography_chart_block').html(GeographyTemplate({'geography': geography_list}));\n\n            if(!$.isEmptyObject(geography)){\n                var mapGeoJSON = Highcharts.maps['custom/world'],\n                data = [];\n                // Generate non-random data for the map\n                var country_iso_code_key = 'iso-a2';\n                $.each(mapGeoJSON.features, function (index, feature) {\n                    var countryISOCode = feature.properties[country_iso_code_key]\n                    var visit_count = geography[countryISOCode] && geography[countryISOCode]['count'] || 0;\n                    data.push({\n                        key: countryISOCode,\n                        value: visit_count\n                    });\n                });\n                // Instantiate chart\n                this.$(\"#geography\").highcharts('Map', {\n                    title: {\n                        text: ''\n                    },\n                    mapNavigation: {\n                        enabled: true,\n                        buttonOptions: {\n                            verticalAlign: 'bottom'\n                        }\n                    },\n                    navigation: {\n                        buttonOptions: {\n                            enabled: false,\n                        }\n                    },\n                    colorAxis: {\n                        min: 0,\n                        stops: [\n                            [0, '#EFEFFF'],\n                            [0.5, Highcharts.getOptions().colors[0]],\n                            [1, Highcharts.Color(Highcharts.getOptions().colors[0]).brighten(-0.5).get()]\n                        ]\n                    },\n                    legend: {\n                        enabled: false\n                    },\n                    series: [{\n                        data: data,\n                        mapData: mapGeoJSON,\n                        joinBy: [country_iso_code_key, 'key'],\n                        name: 'Visits',\n                        states: {\n                            hover: {\n                                color: Highcharts.getOptions().colors[2]\n                            }\n                        },\n                    }, {\n                        type: 'mapline',\n                        name: \"Separators\",\n                        data: Highcharts.geojson(mapGeoJSON, 'mapline'),\n                        nullColor: 'gray',\n                        showInLegend: false,\n                        enableMouseTracking: false\n                    }]\n                });\n            }\n        },\n\n        loadReferrals: function(referrals){\n            this.$('.referral_chart_block').html(ReferralsTemplate({'referrals': referrals}));\n            if(referrals.length > 0){\n                var referral_list = [];\n                _.each(referrals, function(val) {\n                    referral_list.push({\n                        data: val.count,\n                        label: val.name\n                    });\n                });\n\n                var col1 = \"#0a316b\",\n                    col2 = \"#0948a7\",\n                    col3 = \"#0156d5\",\n                    col4 = \"#066afe\",\n                    col5 = \"#639bfc\",\n                    col6 = \"#95b5f2\",\n                    col7 = \"#b5ccf6\",\n                    col8 = \"#cfddf7\",\n                    col9 = \"#ebf1fc\",\n                    col10 = \"#e9e9e9\";\n\n                // Instantiate Pie Chart\n                $.plot(\"#referral\",\n                    referral_list,\n                    {\n                       series: {\n                            pie: {\n                                show: true,\n                                innerRadius:.5,\n                                shadow: {\n                                    top: 5,\n                                    left: 15,\n                                    alpha: .3\n                                },\n                                stroke: {\n                                    width: 0\n                                },\n                                label: {\n                                    show: false,\n                                    radius: 3/4,\n                                    background: {\n                                        opacity: 0,\n                                        color: '#000'\n                                    },\n                                    threshold: 0.1\n                                },\n                                highlight: {\n                                    opacity: .08\n                                }\n                            }\n                        },\n                        grid: {\n                            hoverable: true,\n                            clickable: true\n                        },\n                        colors: [col1, col2, col3, col4, col5, col6, col7, col8, col9, col10],\n                        legend: {\n                            show: false\n                        },\n                    }\n                );\n                this.$(\"#referral\").bind(\"plothover\", function (event, pos, item) {\n                    $(\"#tooltip\").remove();\n                    if(item){\n                        var tooltip = item.series.label + ' : ' + parseFloat(item.series.percent).toFixed(2) + '%';\n                        $('<div id=\"tooltip\">' + tooltip + '</div>').css({\n                            top: pos.pageY - 50,\n                            left: pos.pageX - 70,\n                        }).appendTo(\"body\").fadeIn(200);\n                    }\n                });\n            }\n        },\n\n        loadTrendingCategories: function(categories){\n            if(categories.length > 0){\n                var trending_categories = [];\n                var x_axis_labels = [];\n\n                $.each(categories, function (index, val) {\n                    var word = ' View' + (val.views == 1 ? '' : 's');\n                    trending_categories.push([\n                        index,\n                        val.views,\n                        val.name + ' : ' + val.views + word\n                    ])\n                    if(val.name.length > 10){\n                        val.name = val.name.substring(0,10) + '...';\n                    }\n                    x_axis_labels.push([index, val.name])\n                });\n\n                $.plot($(\"#top_trending_cat_chart\"),\n                    [{\n                        data: trending_categories,\n                        label: \"Page Views\"\n                    }], {\n                        series: {\n                            bars: {\n                                order:2,\n                                align:\"center\",\n                                show: true,\n                                lineWidth:1,\n                                barWidth:.6,\n                                fill: true,\n                                fillColor: {\n                                    colors:[ {\n                                        opacity: 1\n                                    }, {\n                                        opacity: 1\n                                    }]\n                                }\n                            },\n                            shadowSize: 2\n                        },\n                        legend: {\n                            show: !1\n                        },\n                        grid: {\n                            hoverable: true,\n                            clickable: true,\n                            tickColor: \"#ecf1f5\",\n                            borderWidth: 0,\n                            margin: 30\n                        }, \n                        colors:[\"#ffc40d\"],\n                        xaxis: {\n                            autoscaleMargin: 0,\n                            ticks: x_axis_labels,\n                            tickDecimals: 0,\n                            tickLength:0\n                        }, \n                        yaxis: {\n                            autoscaleMargin: .5,\n                            ticks: 5,\n                            tickDecimals: 0\n                        }\n                    }\n                )\n\n                this.$(\"#top_trending_cat_chart\").bind(\"plothover\", function (event, pos, item) {\n                    $(\"#tooltip\").remove();\n                    if(item){\n                        var tooltip = item.series.data[item.dataIndex][2];\n                        $('<div id=\"tooltip\">' + tooltip + '</div>').css({\n                            top: item.pageY - 50,\n                            left: item.pageX - 70,\n                        }).appendTo(\"body\").fadeIn(200);\n                    }\n                });\n            }else{\n                this.$('#top_trending_cat_chart').html(\n                    TrendingChaptersTemplate({\n                        'trending_chapters': []\n                    })\n                );\n            }\n        },\n\n        loadVisitorsVsViewsGraph: function(response){\n            var visitors = new Array();\n            var views = new Array();\n\n            var root = this;\n            if(response.slots.length > 0){\n                response.site_visitors.map(function(val, index) {\n                    visitors.push([root.getGraphDate(response.slots[index]), val]);\n                });\n     \n                response.demo_views.map(function(val, index) {\n                    views.push([root.getGraphDate(response.slots[index]), val]);\n                });\n\n                var date_range = this.$('#metrics li.active').attr('data-attr');\n                var tick_size = 'day';\n                var unit_between = 1;\n                var format = \"%b\\n\\n%d\";\n                var Max = 0;\n                var Min = 0;\n                var multiplier = 2;\n\n                switch (date_range){\n                    case 'today':\n                        multiplier = 0.5;\n                        tick_size = 'day';\n                        break;\n                    case 'yesterday':\n                        multiplier = 0.5;\n                        tick_size = 'day';\n                        break;\n                    case 'week':\n                        multiplier = 0.5;\n                        tick_size = 'day';\n                        unit_between = 1;\n                        break;\n                    case 'month':\n                        multiplier = 1.5;\n                        unit_between = 3;\n                        break;\n                    case 'quarter':\n                        multiplier = 3.5;\n                        unit_between = 7;\n                        break;\n                    case 'half-year':\n                        multiplier = 7;\n                        unit_between = 14;\n                        break;\n                    case 'year':\n                        multiplier = 15.5;\n                        tick_size = 'month';\n                        format = \"%b\";\n                        break;\n                    case 'custom':\n                        if( response.slots.length ) {\n                            var dayone = root.getGraphDate(response.slots[0]);\n                            var daytwo = root.getGraphDate(response.slots[response.slots.length - 1]);\n                            var daysdiff = root.dayDifference(dayone, daytwo);\n                            if (daysdiff >= 730) {//2years~\n                                tick_size = 'year';\n                                format = \"%Y\";\n                                multiplier = 365;\n                            } else if (daysdiff >= 365){//year\n                                tick_size = 'month';\n                                format = \"%b\";\n                                multiplier = 15.5;\n                            } else if (daysdiff >= 108) {//half-year~\n                                unit_between = 14;\n                                multiplier = 7;\n                            } else if (daysdiff >= 54) { //Quarter~\n                                unit_between = 7;\n                                multiplier = 3.5;\n                            } else if (daysdiff >= 28) { //Month~\n                                unit_between = 3;\n                                multiplier = 1.5;\n                            } else {\n                                multiplier = 2;\n                            }\n                        }\n                        break;\n                }\n                Max = (root.getGraphDate(response.slots[response.slots.length - 1]) + (86400000*multiplier));\n                Min = (root.getGraphDate(response.slots[0]) - (86400000*multiplier));\n\n                $.plot(\"#spline_chart\",\n                    [{\n                        data: visitors,\n                        label: 'Site Visitors Curve',\n                        curvedLines: {\n                            apply: true,\n                            monotonicFit: true\n                        }\n                    }, {\n                        data: views,\n                        label: 'Demo Views Curve',\n                        curvedLines: {\n                            apply: true,\n                            monotonicFit: true\n                        }\n                    }, {\n                        data: views,\n                        label: 'Demo Views',\n                        points: {\n                            symbol: \"circle\",\n                            fillColor: \"#1e9fb4\",\n                            radius: 5,\n                            show: true\n                        },\n                        lines: {\n                            show: false\n                        },\n                    }, {\n                        data: visitors,\n                        label: 'Site Visitors',\n                        points: {\n                            symbol: \"square\",\n                            fillColor: \"#222838\",\n                            radius: 5,\n                            show: true\n                        },\n                        lines: {\n                            show: false\n                        },\n                    }], {\n                    series: {\n                        curvedLines: {\n                            active: true\n                        },\n                        lines: {\n                            show: true,\n                            fill: true,\n                            fillColor: {\n                                colors:[{\n                                    opacity: 1\n                                },{\n                                    opacity: 1\n                                }]\n                            }\n                        },\n                    },\n                    grid: {\n                         hoverable: true,\n                         clickable: true,\n                         tickColor: \"#ecf1f5\",\n                         borderWidth: 0,\n                         margin: 30\n                    },\n                    legend: false,\n                    xaxis: {\n                        max: Max,\n                        min: Min,\n                        mode: \"time\",\n                        timeformat: format,\n                        tickSize: [unit_between, tick_size],\n                        tickLength:0,\n                    }, \n                    colors:['rgba(34, 40, 56, 0.5)', 'rgba(30, 159, 180, 0.5)']\n                });\n\n                this.$(\"#spline_chart\").bind(\"plothover\", function (event, pos, item) {\n                    $(\"#tooltip\").remove();  \n                    if(item) {\n                        if( item.series.label === 'Site Visitors' || item.series.label === 'Demo Views' ) {\n                            var tooltip = item.series.label + ': ' + item.series.data[item.dataIndex][1];\n                            $('<div id=\"tooltip\">' + tooltip + '</div>').css({\n                                'top': item.pageY - 50,\n                                'left': item.pageX - 70,\n                            }).appendTo(\"body\").fadeIn(200);\n                        }\n                     }\n                });\n            }else{\n                this.$('#spline_chart').html(TrendingChaptersTemplate({\n                    'trending_chapters': []\n                }));\n            }\n        },\n\n        dayDifference: function( time1, time2){\n            var timeDiff = Math.abs(time2 - time1);\n            return Math.ceil(timeDiff / (1000 * 3600 * 24));\n        },\n\n        loadMore: function(event){\n            this.$(event.target).parent().children('.reports_data_row').removeClass('hidden');\n            this.$(event.target).remove();\n            this.loadMoreChapters = true;\n        },\n\n        getGraphDate: function(date_string){\n            var date_string_list = date_string.split(',');\n            var year = parseInt(date_string_list[0]);\n            var month = parseInt(date_string_list[1]) - 1;\n            var day = parseInt(date_string_list[2]);\n            var tzOffset = new Date();\n            tzOffset = tzOffset.getTimezoneOffset() * 60 * 1000;\n            var time = new Date(year, month, day).getTime() - tzOffset;\n            return time;\n        },\n\n    });\n\n    return ReportsView;\n});"],"sourceRoot":""}